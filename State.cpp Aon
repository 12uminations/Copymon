#include "State.h"
#include <SDL_image.h>
#include <iostream>

SDL_Window* State::win = 0;
SDL_Renderer* State::ren = 0;
State* State::current = 0;
State* State::mainmenu = 0;
State* State::fightscene = 0;
Mouse* State::mouse = 0;


State::State() {

	if (!win) { // only happen once
		win = SDL_CreateWindow("Copymon", SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, 640, 480, NULL);
		ren = SDL_CreateRenderer(win, -1, SDL_RENDERER_ACCELERATED);
		mouse = new Mouse(ren);
	}
}

State::~State() {
	
}

MainMenu::MainMenu() {
	backgroundTexture = IMG_LoadTexture(ren, "CopymonBG.png");
	startButton = new Button(ren, 0, 0);
	startButton->setPos(640 / 2 - (100 / 2), 290);
	exitButton = new Button(ren, 0, 64);
	exitButton->setPos(640 / 2 - (100 / 2), 360);
}

MainMenu::~MainMenu() {
	delete startButton;
}

void MainMenu::enter() {
	//Start up the music
	//center the mouse cursor on screen?

	running = true;
}

void MainMenu::update() {
	//get input
	while (running) {
		while (SDL_PollEvent(&event)) {
			switch (event.type) {
			case SDL_QUIT:
				 SDL_Quit();
				 std::exit(0); //bad form
			case SDL_MOUSEBUTTONUP:
				if (event.button.button == SDL_BUTTON_LEFT) {
					if (startButton->selected) {
						current = fightscene;
						running = false;
						break; 
					}
					if (exitButton->selected) {
						SDL_Quit();
						break;
					}
				}
			}// end switch
		}// end poll loop
		mouse->update(); //mouse  
		startButton->update(mouse);//update buttons
		exitButton->update(mouse);//update buttons
		SDL_RenderClear(ren);
		//change states
		SDL_RenderCopy(ren, backgroundTexture, NULL, NULL);
		startButton->draw(ren);//draw()
		exitButton->draw(ren);//draw()
		mouse->draw(ren);

		SDL_RenderPresent(ren);	
	}//end main loop
}

void MainMenu::exit() {
	//disable mouse?
	//stop music? change music?
	//play sound
}

FightScene::FightScene() {
	backgroundTexture = IMG_LoadTexture(ren, "CopymonFS.png");
	backButton = new Button1(ren, 0, 0);
	backButton->setPos(10, 10);
}

FightScene::~FightScene() {

}

void FightScene::enter() {
	running = true;
}

void FightScene::update() {
	//get input
	while (running) {
		while (SDL_PollEvent(&event)) {
			switch (event.type) {
			case SDL_QUIT:
				SDL_Quit();
				std::exit(0); //bad form
			case SDL_MOUSEBUTTONUP:
				if (event.button.button == SDL_BUTTON_LEFT) {
					if (backButton->selected) {
						current = mainmenu;
						running = false;
						break;
					}
				}
			}// end switch
		}// end poll loop
		mouse->update();
		backButton->update(mouse);
		SDL_RenderClear(ren);

		SDL_RenderCopy(ren, backgroundTexture, NULL, NULL);
		backButton->draw(ren);
		mouse->draw(ren);

		SDL_RenderPresent(ren);
	}
}

void FightScene::exit() {
	
}
